"use strict";!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):(window.WatchJS=a(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){function a(){v=null;for(var a=0;a<u.length;a++)u[a]();u.length=0}var b={noMore:!1,useDirtyCheck:!1},c=[],d=[],e=[],f=!1;try{f=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(g){}var h=function(a){var b={};return a&&"[object Function]"==b.toString.call(a)},i=function(a){return"[object Array]"===Object.prototype.toString.call(a)},j=function(a){return"[object Object]"==={}.toString.apply(a)},k=function(a,b){var c=[],d=[];if("string"!=typeof a&&"string"!=typeof b){if(i(a))for(var e=0;e<a.length;e++)void 0===b[e]&&c.push(e);else for(e in a)a.hasOwnProperty(e)&&void 0===b[e]&&c.push(e);if(i(b))for(var f=0;f<b.length;f++)void 0===a[f]&&d.push(f);else for(f in b)b.hasOwnProperty(f)&&void 0===a[f]&&d.push(f)}return{added:c,removed:d}},l=function(a){if(null==a||"object"!=typeof a)return a;var b,c=a.constructor();for(b in a)c[b]=a[b];return c},m=function(a,b,c,d){try{Object.observe(a,function(a){a.forEach(function(a){a.name===b&&d(a.object[a.name])})})}catch(e){try{Object.defineProperty(a,b,{get:c,set:function(a){d.call(this,a,!0)},enumerable:!0,configurable:!0})}catch(f){try{Object.prototype.__defineGetter__.call(a,b,c),Object.prototype.__defineSetter__.call(a,b,function(a){d.call(this,a,!0)})}catch(g){o(a,b,d)}}}},n=function(a,b,c){try{Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!1,value:c})}catch(d){a[b]=c}},o=function(a,b,c){d[d.length]={prop:b,object:a,orig:l(a[b]),callback:c}},p=function(a,b,c,d){if("string"!=typeof a&&(a instanceof Object||i(a))){if(i(a)){if(A(a,"__watchall__",b,c),void 0===c||c>0)for(var e=0;e<a.length;e++)p(a[e],b,c,d)}else{var g=[];for(e in a)"$val"==e||!f&&"watchers"===e||Object.prototype.hasOwnProperty.call(a,e)&&g.push(e);q(a,g,b,c,d)}d&&K(a,"$$watchlengthsubjectroot",b,c)}},q=function(a,b,c,d,e){if("string"!=typeof a&&(a instanceof Object||i(a)))for(var f=0;f<b.length;f++)r(a,b[f],c,d,e)},r=function(a,b,c,d,e){"string"!=typeof a&&(a instanceof Object||i(a))&&!h(a[b])&&(null!=a[b]&&(void 0===d||d>0)&&p(a[b],c,void 0!==d?d-1:d),A(a,b,c,d),e&&(void 0===d||d>0)&&K(a,b,c,d))},s=function(a,b){if(!(a instanceof String)&&(a instanceof Object||i(a)))if(i(a)){for(var c=["__watchall__"],d=0;d<a.length;d++)c.push(d);t(a,c,b)}else{var e=function(a){var c,d=[];for(c in a)a.hasOwnProperty(c)&&(a[c]instanceof Object?e(a[c]):d.push(c));t(a,d,b)};e(a)}},t=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&F(a,b[d],c)},u=[],v=null,w=function(){return v||(v=setTimeout(a)),v},x=function(a){null==v&&w(),u[u.length]=a},y=function(a,b,c,d){var e=null,f=-1,g=i(a);p(a,function(c,d,h,i){var j=w();if(f!==j&&(f=j,e={type:"update"},e.value=a,e.splices=null,x(function(){b.call(this,e),e=null})),g&&a===this&&null!==e){if("pop"===d||"shift"===d)h=[],i=[i];else if("push"===d||"unshift"===d)h=[h],i=[];else if("splice"!==d)return;e.splices||(e.splices=[]),e.splices[e.splices.length]={index:c,deleteCount:i?i.length:0,addedCount:h?h.length:0,added:h,deleted:i}}},1==c?void 0:0,d)},z=function(a,b,c,d,e){a&&b&&(r(a,b,function(a,b,f,g){a={type:"update"},a.value=f,a.oldvalue=g,(d&&j(f)||i(f))&&y(f,c,d,e),c.call(this,a)},0),(d&&j(a[b])||i(a[b]))&&y(a[b],c,d,e))},A=function(a,c,d,e){var f=!1,g=i(a);for(a.watchers||(n(a,"watchers",{}),g&&E(a,function(b,d,f,g){if(I(a,b,d,f,g),0!==e&&f&&(j(f)||i(f))){var h,k;for(b=a.watchers[c],(g=a.watchers.__watchall__)&&(b=b?b.concat(g):g),k=b?b.length:0,g=0;k>g;g++)if("splice"!==d)p(f,b[g],void 0===e?e:e-1);else for(h=0;h<f.length;h++)p(f[h],b[g],void 0===e?e:e-1)}})),a.watchers[c]||(a.watchers[c]=[],g||(f=!0)),g=0;g<a.watchers[c].length;g++)if(a.watchers[c][g]===d)return;if(a.watchers[c].push(d),f){var h=a[c];d=function(){return h},f=function(d,f){var g=h;if(h=d,0!==e&&a[c]&&(j(a[c])||i(a[c]))&&!a[c].watchers){var k,l=a.watchers[c].length;for(k=0;l>k;k++)p(a[c],a.watchers[c][k],void 0===e?e:e-1)}a.watchers&&(a.watchers.__wjs_suspend__||a.watchers["__wjs_suspend__"+c])?G(a,c):b.noMore||g===d||(f?I(a,c,"set",d,g):B(a,c,"set",d,g),b.noMore=!1)},b.useDirtyCheck?o(a,c,f):m(a,c,d,f)}},B=function(a,b,c,d,e){if(void 0!==b){var f,g=a.watchers[b];(f=a.watchers.__watchall__)&&(g=g?g.concat(f):f),f=g?g.length:0;for(var h=0;f>h;h++)g[h].call(a,b,c,d,e)}else for(b in a)a.hasOwnProperty(b)&&B(a,b,c,d,e)},C="pop push reverse shift sort slice unshift splice".split(" "),D=function(a,b,c,d){n(a,c,function(){var e,f,g,h=0;if("splice"===c){for(g=arguments[0],f=a.slice(g,g+arguments[1]),e=[],h=2;h<arguments.length;h++)e[h-2]=arguments[h];h=g}else e=0<arguments.length?arguments[0]:void 0;return g=b.apply(a,arguments),"slice"!==c&&("pop"===c?(f=g,h=a.length):"push"===c?h=a.length-1:"shift"===c?f=g:"unshift"!==c&&void 0===e&&(e=g),d.call(a,h,c,e,f)),g})},E=function(a,b){if(h(b)&&a&&!(a instanceof String)&&i(a))for(var c,d=C.length;d--;)c=C[d],D(a,a[c],c,b)},F=function(a,b,e){if(void 0===e&&a.watchers[b])delete a.watchers[b];else for(var f=0;f<a.watchers[b].length;f++)a.watchers[b][f]==e&&a.watchers[b].splice(f,1);for(f=0;f<c.length;f++){var g=c[f];g.obj==a&&g.prop==b&&g.watcher==e&&c.splice(f,1)}for(e=0;e<d.length;e++)f=d[e],g=f.object.watchers,(f=f.object==a&&f.prop==b&&g&&(!g[b]||0==g[b].length))&&d.splice(e,1)},G=function(a,b){x(function(){delete a.watchers.__wjs_suspend__,delete a.watchers["__wjs_suspend__"+b]})},H=null,I=function(a,b,c,d,f){e[e.length]={obj:a,prop:b,mode:c,newval:d,oldval:f},null===H&&(H=setTimeout(J))},J=function(){var a=null;H=null;for(var b=0;b<e.length;b++)a=e[b],B(a.obj,a.prop,a.mode,a.newval,a.oldval);a&&(e=[])},K=function(a,b,d,e){var f;f=l("$$watchlengthsubjectroot"===b?a:a[b]),c.push({obj:a,prop:b,actual:f,watcher:d,level:e})};return setInterval(function(){for(var a=0;a<c.length;a++){var b=c[a];if("$$watchlengthsubjectroot"===b.prop){var e=k(b.obj,b.actual);(e.added.length||e.removed.length)&&(e.added.length&&q(b.obj,e.added,b.watcher,b.level-1,!0),b.watcher.call(b.obj,"root","differentattr",e,b.actual)),b.actual=l(b.obj)}else{if(e=k(b.obj[b.prop],b.actual),e.added.length||e.removed.length){if(e.added.length)for(var g=0;g<b.obj.watchers[b.prop].length;g++)q(b.obj[b.prop],e.added,b.obj.watchers[b.prop][g],b.level-1,!0);B(b.obj,b.prop,"differentattr",e,b.actual)}b.actual=l(b.obj[b.prop])}}for(a in d){var b=d[a],e=b.object[b.prop],g=b.orig,h=e,i=void 0,m=!0;if(g!==h)if(j(g)){for(i in g)if((f||"watchers"!==i)&&g[i]!==h[i]){m=!1;break}}else m=!1;m||(b.orig=l(e),b.callback(e))}},50),b.watch=function(){h(arguments[1])?p.apply(this,arguments):i(arguments[1])?q.apply(this,arguments):r.apply(this,arguments)},b.unwatch=function(){h(arguments[1])?s.apply(this,arguments):i(arguments[1])?t.apply(this,arguments):F.apply(this,arguments)},b.callWatchers=B,b.suspend=function(a,b){a.watchers&&(a.watchers["__wjs_suspend__"+(void 0!==b?b:"")]=!0)},b.onChange=function(){(h(arguments[2])?z:y).apply(this,arguments)},b});var singular;!function(a){a.isString=function(a){return"string"==typeof a},a.isNumber=function(a){return"number"==typeof a},a.isBoolean=function(a){return"boolean"==typeof a},a.isFunction=function(a){return"function"==typeof a},a.isObject=function(a){return"object"==typeof a},a.isDefined=function(a){return"undefined"!=typeof a},a.isUndefined=function(a){return"undefined"==typeof a},a.concat=function(){return Array.prototype.slice.call(arguments).join("")},a.template=function(a,b){return a.replace(/{{(.+?)}}/g,function(a,c){return c.split(".").reduce(function(a,b){return a[b]},b)})},a.com=function(){var b=function(b){return a.isObject(b)?b:{}},c=function(a,b){d(a,b),e(a,b)},d=function(b,c){a.isFunction(b.init)&&b.init(c)},e=function(b,c){function d(){return a.template(b.draw(c),b)}a.isFunction(b.draw)&&(watch(b,function(){c.innerHTML=d()}),c.innerHTML=d())};return{create:b,render:c}}(),a.route=function(){var b={},c=function(c,d){a.isString(c)&&a.isFunction(d)&&(b[c]=d)},d=function(c){a.isDefined(b[c])&&delete b[c]},e=function(){b={}},f=function(c){a.isDefined(b[c])&&b[c]()},g=function(){window.addEventListener("load",i),window.addEventListener("hashchange",i)},h=function(){window.removeEventListener("load",i),window.removeEventListener("hashchange",i)},i=function(){f(location.hash.split("?")[0])};return{map:c,unmap:d,clear:e,call:f,listen:g,ignore:h}}(),a.http=function(){return{}}()}(singular||(singular={}));